<div class="admin-layout" [class.dark-mode]="darkMode">
  <!-- Sidebar -->
  <aside class="admin-sidebar" [class.collapsed]="sidebarCollapsed">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <span class="logo-text">JAI1</span>
        <span class="logo-badge">Admin</span>
      </div>
      <!-- Close button only visible on mobile -->
      <button class="sidebar-close-mobile" (click)="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
      <!-- Main Section -->
      <div class="nav-section">
        <span class="nav-section-title">Principal</span>
        <a class="nav-item active" (click)="$event.preventDefault()">
          <span class="nav-icon">üìä</span>
          <span class="nav-label">Dashboard</span>
        </a>
      </div>

      <!-- Clients Section -->
      <div class="nav-section">
        <span class="nav-section-title">Clientes</span>
        <a class="nav-item" (click)="goToDelays()">
          <span class="nav-icon">‚è∞</span>
          <span class="nav-label">Demoras</span>
        </a>
        <a class="nav-item" (click)="goToAlarms()">
          <span class="nav-icon">üîî</span>
          <span class="nav-label">Alarmas</span>
        </a>
        <a class="nav-item" (click)="goToTickets()">
          <span class="nav-icon">üé´</span>
          <span class="nav-label">Tickets</span>
        </a>
      </div>

      <!-- Finance Section -->
      <div class="nav-section">
        <span class="nav-section-title">Finanzas</span>
        <a class="nav-item" (click)="goToPayments()">
          <span class="nav-icon">üí∞</span>
          <span class="nav-label">Pagos</span>
        </a>
        <a class="nav-item" (click)="goToReferrals()">
          <span class="nav-icon">üéÅ</span>
          <span class="nav-label">Referidos</span>
        </a>
        <a class="nav-item" (click)="goToAccounts()">
          <span class="nav-icon">üîë</span>
          <span class="nav-label">Cuentas</span>
        </a>
      </div>

      <!-- Program Section -->
      <div class="nav-section">
        <span class="nav-section-title">Programa</span>
        <a class="nav-item" (click)="goToJai1gents()">
          <span class="nav-icon">ü§ù</span>
          <span class="nav-label">JAI1GENTS</span>
        </a>
      </div>

      <!-- Tools Section -->
      <div class="nav-section">
        <span class="nav-section-title">Herramientas</span>
        <a class="nav-item" (click)="checkMissingDocuments()" [class.disabled]="isCheckingMissingDocs">
          <span class="nav-icon">üìÑ</span>
          <span class="nav-label">{{ isCheckingMissingDocs ? 'Verificando...' : 'Recordar Docs' }}</span>
        </a>
        <div class="nav-item-sub">
          <span class="cron-status" [class.enabled]="missingDocsCronEnabled" (click)="toggleMissingDocsCron()">
            {{ missingDocsCronEnabled ? '‚è∞ Auto: ON' : '‚è∏Ô∏è Auto: OFF' }}
          </span>
          <button class="btn-info-mini" (click)="showMissingDocsInfoModal = true" title="Info">‚ÑπÔ∏è</button>
        </div>
      </div>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <div class="admin-user">
        <span class="admin-avatar">üë§</span>
        <span class="admin-name">Administrador</span>
      </div>
      <button class="btn-sidebar-logout" (click)="logout()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        <span>Cerrar sesi√≥n</span>
      </button>
    </div>
  </aside>

  <!-- Main Container -->
  <div class="admin-main-container">
    <!-- Top Header Bar -->
    <header class="admin-topbar">
      <div class="topbar-left">
        <button class="mobile-menu-toggle" (click)="toggleSidebar()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12h18M3 6h18M3 18h18"/>
          </svg>
        </button>
        <h1 class="topbar-title">Dashboard de Administraci√≥n</h1>
      </div>
      <div class="topbar-actions">
        <button class="btn-topbar btn-refresh" (click)="refreshData()" [disabled]="isRefreshing">
          <svg *ngIf="!isRefreshing" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6"/>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
          </svg>
          <svg *ngIf="isRefreshing" class="spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="32"/>
          </svg>
          <span>{{ isRefreshing ? 'Actualizando...' : 'Actualizar' }}</span>
        </button>
        <button class="btn-topbar btn-export" (click)="exportToExcel()" [disabled]="isExporting">
          <svg *ngIf="!isExporting" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          <svg *ngIf="isExporting" class="spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="32"/>
          </svg>
          <span>{{ isExporting ? 'Exportando...' : 'Exportar Excel' }}</span>
        </button>
        <!-- Dark Mode Toggle -->
        <div class="topbar-dark-mode-toggle" (click)="toggleDarkMode()">
          <span class="dark-mode-icon">{{ darkMode ? '‚òÄÔ∏è' : 'üåô' }}</span>
          <span class="dark-mode-text">Dark mode</span>
          <div class="topbar-toggle-switch" [class.active]="darkMode">
            <div class="topbar-toggle-knob"></div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
    <!-- Page Subtitle -->
    <div class="page-header">
      <p class="page-subtitle">Gestiona todos los clientes y sus declaraciones</p>
    </div>

    <!-- Season Summary Stats -->
    <div class="season-stats" *ngIf="seasonStats || isLoadingStats">
      <div class="season-stat-card">
        <div class="season-stat-icon clients-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="season-stat-content">
          <div class="season-stat-value" *ngIf="!isLoadingStats">{{ seasonStats?.totalClients || 0 }}</div>
          <div class="season-stat-value loading" *ngIf="isLoadingStats">---</div>
          <div class="season-stat-label">Total Clientes</div>
        </div>
      </div>

      <div class="season-stat-card">
        <div class="season-stat-icon completed-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="season-stat-content">
          <div class="season-stat-value" *ngIf="!isLoadingStats">{{ seasonStats?.taxesCompletedPercent || 0 }}%</div>
          <div class="season-stat-value loading" *ngIf="isLoadingStats">---</div>
          <div class="season-stat-label">Taxes Completados</div>
        </div>
      </div>

      <div class="season-stat-card">
        <div class="season-stat-icon projected-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
        </div>
        <div class="season-stat-content">
          <div class="season-stat-value" *ngIf="!isLoadingStats">${{ (seasonStats?.projectedEarnings || 0) | number:'1.0-0' }}</div>
          <div class="season-stat-value loading" *ngIf="isLoadingStats">---</div>
          <div class="season-stat-label">Ganancias Proyectadas</div>
        </div>
      </div>

      <div class="season-stat-card highlight">
        <div class="season-stat-icon earnings-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
            <line x1="1" y1="10" x2="23" y2="10"></line>
          </svg>
        </div>
        <div class="season-stat-content">
          <div class="season-stat-value" *ngIf="!isLoadingStats">${{ (seasonStats?.earningsToDate || 0) | number:'1.0-0' }}</div>
          <div class="season-stat-value loading" *ngIf="isLoadingStats">---</div>
          <div class="season-stat-label">Ganancias Realizadas</div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-banner" *ngIf="errorMessage">
      <div class="error-content">
        <span class="error-icon">‚ö†Ô∏è</span>
        <div class="error-text">
          <span class="error-message">{{ errorMessage }}</span>
          <span class="error-code" *ngIf="errorCode">({{ errorCode }})</span>
        </div>
      </div>
      <div class="error-actions">
        <button class="btn-retry" (click)="refreshData()">Reintentar</button>
        <button class="btn-dismiss" (click)="clearError()">Cerrar</button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card pending" [class.active]="selectedFilter === 'group_pending'" (click)="filterClients('group_pending')">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.pending }}</div>
          <div class="stat-label">Pendientes</div>
        </div>
      </div>

      <div class="stat-card review" [class.active]="selectedFilter === 'group_in_review'" (click)="filterClients('group_in_review')">
        <div class="stat-icon">üîç</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.inReview }}</div>
          <div class="stat-label">En Proceso</div>
        </div>
      </div>

      <div class="stat-card completed" [class.active]="selectedFilter === 'group_completed'" (click)="filterClients('group_completed')">
        <div class="stat-icon">‚úì</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.completed }}</div>
          <div class="stat-label">Completados</div>
        </div>
      </div>

      <div class="stat-card attention" [class.active]="selectedFilter === 'group_needs_attention'" (click)="filterClients('group_needs_attention')">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.needsAttention }}</div>
          <div class="stat-label">Requieren Atencion</div>
        </div>
      </div>
    </div>

    <!-- Search and Filter -->
    <div class="search-filter-bar">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Buscar por nombre o email..."
        (input)="onSearchInput()"
        (keyup.enter)="onSearch()"
      />
      <select [(ngModel)]="selectedFilter" (change)="filterClients(selectedFilter)">
        <option *ngFor="let filter of statusFilters; trackBy: trackByFilterValue" [value]="filter.value">
          {{ filter.label }}
        </option>
      </select>
      <button class="btn-search" (click)="onSearch()">Buscar</button>
      <button class="btn-advanced-filters" (click)="toggleAdvancedFilters()" [class.active]="showAdvancedFilters || activeAdvancedFiltersCount > 0">
        <span>üîç Filtros</span>
        <span class="filter-count" *ngIf="activeAdvancedFiltersCount > 0">{{ activeAdvancedFiltersCount }}</span>
      </button>
    </div>

    <!-- Advanced Filters Panel -->
    <div class="advanced-filters-panel" [class.expanded]="showAdvancedFilters">
      <div class="filters-grid">
        <!-- Date Range -->
        <div class="filter-group">
          <label>Fecha Registro (Desde)</label>
          <input type="date" [(ngModel)]="advancedFilters.dateFrom" />
        </div>
        <div class="filter-group">
          <label>Fecha Registro (Hasta)</label>
          <input type="date" [(ngModel)]="advancedFilters.dateTo" />
        </div>

        <!-- Has Problem -->
        <div class="filter-group">
          <label>Con Problemas</label>
          <select [(ngModel)]="advancedFilters.hasProblem">
            <option *ngFor="let opt of hasProblemOptions" [ngValue]="opt.value">{{ opt.label }}</option>
          </select>
        </div>

        <!-- Case Status -->
        <div class="filter-group">
          <label>Estado del Caso</label>
          <select [(ngModel)]="advancedFilters.caseStatus">
            <option *ngFor="let opt of caseStatusOptions" [ngValue]="opt.value">{{ opt.label }}</option>
          </select>
        </div>

        <!-- Federal Status -->
        <div class="filter-group">
          <label>Estado Federal</label>
          <select [(ngModel)]="advancedFilters.federalStatus">
            <option *ngFor="let opt of federalStatusOptions" [ngValue]="opt.value">{{ opt.label }}</option>
          </select>
        </div>

        <!-- State Status -->
        <div class="filter-group">
          <label>Estado Estatal</label>
          <select [(ngModel)]="advancedFilters.stateStatus">
            <option *ngFor="let opt of stateStatusOptions" [ngValue]="opt.value">{{ opt.label }}</option>
          </select>
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn-apply-filters" (click)="applyAdvancedFilters()">
          Aplicar Filtros
        </button>
        <button class="btn-clear-filters" (click)="clearAdvancedFilters()" *ngIf="activeAdvancedFiltersCount > 0">
          Limpiar Filtros
        </button>
      </div>
    </div>

    <!-- Active Group Filter Indicator -->
    <div class="active-filter-indicator" *ngIf="getActiveGroupFilterInfo() as groupInfo">
      <div class="filter-indicator-content">
        <span class="filter-label">Filtrando: <strong>{{ groupInfo.label }}</strong></span>
        <span class="filter-includes">Incluye: {{ groupInfo.statuses.join(', ') }}</span>
      </div>
      <button class="btn-clear-indicator" (click)="filterClients('all')">Limpiar filtro</button>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Cargando clientes...</p>
    </div>

    <!-- Clients Table -->
    <div class="clients-section" *ngIf="!isLoading">
      <div class="section-header">
        <h2>Lista de Clientes</h2>
        <div class="filter-info" *ngIf="selectedFilter !== 'all'">
          <button class="btn-clear-filter" (click)="filterClients('all')">
            Mostrar todos
          </button>
        </div>
      </div>

      <!-- Sort Buttons (Server-side) -->
      <div class="sort-buttons">
        <span class="sort-label">Ordenar por:</span>
        <button
          class="btn-sort"
          [class.active]="sortColumn === 'createdAt'"
          (click)="sortBy('createdAt')">
          Fecha {{ sortColumn === 'createdAt' ? (sortDirection === 'desc' ? '‚Üì' : '‚Üë') : '‚Üì' }}
        </button>
        <button
          class="btn-sort"
          [class.active]="sortColumn === 'name'"
          (click)="sortBy('name')">
          Nombre {{ sortColumn === 'name' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : 'A-Z' }}
        </button>
        <button
          class="btn-sort"
          [class.active]="sortColumn === 'email'"
          (click)="sortBy('email')">
          Email {{ sortColumn === 'email' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : 'A-Z' }}
        </button>
        <button
          class="btn-sort-clear"
          *ngIf="sortColumn !== 'createdAt' || sortDirection !== 'desc'"
          (click)="clearSort()">
          Limpiar
        </button>
      </div>

      <!-- Combined Filter Indicator -->
      <div class="active-filters-bar" *ngIf="getTotalActiveFiltersCount() > 0">
        <span class="filters-label">Filtros activos ({{ getTotalActiveFiltersCount() }}):</span>
        <div class="filter-tags">
          <span
            class="filter-tag"
            *ngFor="let filter of getActiveFilterLabels()"
            (click)="removeFilter(filter.key)">
            {{ filter.label }}
            <span class="remove-icon">√ó</span>
          </span>
        </div>
        <button class="btn-clear-all-filters" (click)="clearAllFilters()">
          Limpiar todos
        </button>
      </div>

      <div class="clients-table-wrapper">
        <table class="clients-table-new">
          <thead>
            <tr>
              <th class="col-name">Nombre</th>
              <th class="col-ssn">SSN</th>
              <th class="col-date">Fecha Presentacion</th>
              <th class="col-date">√öltima Revisi√≥n</th>
              <th class="col-notes">Obs. Federal</th>
              <th class="col-refund">Dev. Federal</th>
              <th class="col-status">Estado Fed.</th>
              <th class="col-notes">Obs. Estatal</th>
              <th class="col-refund">Dev. Estatal</th>
              <th class="col-status">Estado Est.</th>
              <th class="col-accounts">Cuentas</th>
              <th class="col-actions">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let client of filteredClients; trackBy: trackById" class="table-row-new">
              <!-- 1. Name -->
              <td class="col-name">
                <div class="client-name-cell">
                  <span class="client-name">{{ client.user.firstName || 'Sin' }} {{ client.user.lastName || 'Nombre' }}</span>
                  <span class="ready-indicator" *ngIf="client.isReadyToPresent" title="Listo para presentar">‚úì</span>
                </div>
              </td>

              <!-- 2. SSN -->
              <!-- SSN (click to copy without dashes) -->
              <td class="col-ssn">
                <span class="ssn-value" (click)="copyToClipboard(client.ssn?.replace(/-/g, '')); $event.stopPropagation()" [title]="'Click para copiar'">
                  {{ client.ssn ? client.ssn.replace(/-/g, '') : '---' }}
                </span>
              </td>

              <!-- 3. Tax Filing Date (derived from caseStatusChangedAt when TAXES_FILED) -->
              <td class="col-date">
                <span *ngIf="client.caseStatus === 'taxes_filed' && client.caseStatusChangedAt">{{ client.caseStatusChangedAt | date:'dd/MM/yy' }}</span>
                <span *ngIf="client.caseStatus !== 'taxes_filed' || !client.caseStatusChangedAt" class="no-data">---</span>
              </td>

              <!-- 4. Last Review Date -->
              <td class="col-date">
                <span *ngIf="client.lastReviewDate">{{ client.lastReviewDate | date:'dd/MM/yy' }}</span>
                <span *ngIf="!client.lastReviewDate" class="no-data">---</span>
              </td>

              <!-- 5. Federal Notes -->
              <td class="col-notes">
                <span class="notes-preview" *ngIf="client.federalLastComment" [title]="client.federalLastComment">
                  {{ client.federalLastComment | slice:0:30 }}{{ client.federalLastComment.length > 30 ? '...' : '' }}
                </span>
                <span *ngIf="!client.federalLastComment" class="no-data">---</span>
              </td>

              <!-- 6. Federal Refund -->
              <td class="col-refund">
                <span *ngIf="client.federalActualRefund != null" class="refund-amount">
                  ${{ client.federalActualRefund | number:'1.0-0' }}
                </span>
                <span *ngIf="client.federalActualRefund == null" class="no-data">---</span>
              </td>

              <!-- 7. Federal Status -->
              <td class="col-status">
                <span *ngIf="client.caseStatus === 'taxes_filed'" class="status-badge-mini" [ngClass]="getStatusClass(client.federalStatusNew)">
                  {{ getStatusLabel(client.federalStatusNew) }}
                </span>
                <span *ngIf="client.caseStatus !== 'taxes_filed'" class="status-badge-mini" [ngClass]="getStatusClass(client.caseStatus)">
                  {{ getCaseStatusLabel(client.caseStatus) }}
                </span>
              </td>

              <!-- 8. State Notes -->
              <td class="col-notes">
                <span class="notes-preview" *ngIf="client.stateLastComment" [title]="client.stateLastComment">
                  {{ client.stateLastComment | slice:0:30 }}{{ client.stateLastComment.length > 30 ? '...' : '' }}
                </span>
                <span *ngIf="!client.stateLastComment" class="no-data">---</span>
              </td>

              <!-- 9. State Refund -->
              <td class="col-refund">
                <span *ngIf="client.stateActualRefund != null" class="refund-amount">
                  ${{ client.stateActualRefund | number:'1.0-0' }}
                </span>
                <span *ngIf="client.stateActualRefund == null" class="no-data">---</span>
              </td>

              <!-- 10. State Status -->
              <td class="col-status">
                <span *ngIf="client.caseStatus === 'taxes_filed'" class="status-badge-mini" [ngClass]="getStatusClass(client.stateStatusNew)">
                  {{ getStatusLabel(client.stateStatusNew) }}
                </span>
                <span *ngIf="client.caseStatus !== 'taxes_filed'" class="no-data">---</span>
              </td>

              <!-- 11. Client Accounts Link -->
              <td class="col-accounts">
                <button class="btn-accounts" (click)="openCredentialsModal(client)" title="Ver credenciales">
                  üîë
                </button>
              </td>

              <!-- 12. Actions -->
              <td class="col-actions">
                <button class="btn-view" (click)="viewClient(client.id)">
                  Ver ‚Üí
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredClients.length === 0">
        <div class="empty-icon">üìã</div>
        <h3>No hay clientes en esta categoria</h3>
        <p>Selecciona "Mostrar todos" para ver todos los clientes</p>
      </div>

      <!-- Load More / Pagination Info -->
      <div class="pagination-section" *ngIf="filteredClients.length > 0">
        <div class="pagination-info" *ngIf="hasMore">
          <span class="loaded-count">Mostrando {{ totalLoaded }} clientes</span>
          <span class="more-available">Hay mas clientes disponibles</span>
        </div>
        <button
          class="btn-load-more"
          *ngIf="hasMore"
          (click)="loadMoreClients()"
          [disabled]="isLoadingMore"
        >
          <span *ngIf="!isLoadingMore">Cargar mas clientes</span>
          <span *ngIf="isLoadingMore">Cargando...</span>
        </button>
      </div>
    </div>
  </main>
  </div>
</div>

<!-- Sidebar Overlay (mobile) -->
<div class="sidebar-overlay" [class.active]="!sidebarCollapsed" (click)="toggleSidebar()"></div>

<!-- Credentials Modal -->
<div class="modal-overlay" *ngIf="showCredentialsModal" (click)="closeCredentialsModal()">
  <div class="modal-content credentials-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Credenciales de Cliente</h3>
      <button class="modal-close" (click)="closeCredentialsModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="selectedClientCredentials">
      <p class="client-name-modal">{{ selectedClientCredentials.clientName }}</p>

      <div class="credentials-section">
        <h4>TurboTax</h4>
        <div class="credential-row">
          <span class="credential-label">Usuario:</span>
          <span class="credential-value" (click)="copyToClipboard(selectedClientCredentials.credentials?.turbotaxEmail)">
            {{ selectedClientCredentials.credentials?.turbotaxEmail || '---' }}
          </span>
        </div>
        <div class="credential-row">
          <span class="credential-label">Password:</span>
          <span class="credential-value" (click)="copyToClipboard(selectedClientCredentials.credentials?.turbotaxPassword)">
            {{ selectedClientCredentials.credentials?.turbotaxPassword || '---' }}
          </span>
        </div>
      </div>

      <div class="credentials-section">
        <h4>IRS</h4>
        <div class="credential-row">
          <span class="credential-label">Usuario:</span>
          <span class="credential-value" (click)="copyToClipboard(selectedClientCredentials.credentials?.irsUsername)">
            {{ selectedClientCredentials.credentials?.irsUsername || '---' }}
          </span>
        </div>
        <div class="credential-row">
          <span class="credential-label">Password:</span>
          <span class="credential-value" (click)="copyToClipboard(selectedClientCredentials.credentials?.irsPassword)">
            {{ selectedClientCredentials.credentials?.irsPassword || '---' }}
          </span>
        </div>
      </div>

      <div class="credentials-section">
        <h4>Estado</h4>
        <div class="credential-row">
          <span class="credential-label">Usuario:</span>
          <span class="credential-value" (click)="copyToClipboard(selectedClientCredentials.credentials?.stateUsername)">
            {{ selectedClientCredentials.credentials?.stateUsername || '---' }}
          </span>
        </div>
        <div class="credential-row">
          <span class="credential-label">Password:</span>
          <span class="credential-value" (click)="copyToClipboard(selectedClientCredentials.credentials?.statePassword)">
            {{ selectedClientCredentials.credentials?.statePassword || '---' }}
          </span>
        </div>
      </div>

      <p class="copy-hint">Click en cualquier valor para copiar al portapapeles</p>
    </div>
  </div>
</div>

<!-- Missing Documents Result Modal -->
<div class="modal-overlay" *ngIf="showMissingDocsModal" (click)="closeMissingDocsModal()">
  <div class="modal-content missing-docs-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Recordatorio de Documentos Enviado</h3>
      <button class="modal-close" (click)="closeMissingDocsModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="missingDocsResult">
      <div class="missing-docs-results">
        <div class="result-item success">
          <span class="result-icon">‚úÖ</span>
          <span class="result-label">Clientes notificados:</span>
          <span class="result-value">{{ missingDocsResult.notified }}</span>
        </div>
        <div class="result-item skipped">
          <span class="result-icon">‚è≠Ô∏è</span>
          <span class="result-label">Omitidos (ya notificados):</span>
          <span class="result-value">{{ missingDocsResult.skipped }}</span>
        </div>
      </div>
      <p class="missing-docs-info">
        Se enviaron notificaciones a clientes que llevan mas de 3 dias sin completar su perfil o subir documentos W2.
        Cada cliente recibe maximo 3 recordatorios por mes.
      </p>
      <div class="cron-status-info">
        <span class="cron-status-label">Recordatorio automatico diario (9:00 AM):</span>
        <span class="cron-status-value" [class.enabled]="missingDocsCronEnabled" [class.disabled]="!missingDocsCronEnabled">
          {{ missingDocsCronEnabled ? 'ACTIVO' : 'PAUSADO' }}
        </span>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" (click)="closeMissingDocsModal()">Cerrar</button>
    </div>
  </div>
</div>

<!-- Missing Documents Info Modal -->
<div class="modal-overlay" *ngIf="showMissingDocsInfoModal" (click)="showMissingDocsInfoModal = false">
  <div class="modal-content info-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üìÑ Recordatorio de Documentos - Informaci√≥n</h3>
      <button class="modal-close" (click)="showMissingDocsInfoModal = false">&times;</button>
    </div>
    <div class="modal-body">
      <div class="info-section">
        <h4>¬øQue hace esta funcion?</h4>
        <p>
          Envia notificaciones automaticas a clientes que se registraron pero <strong>no han completado su documentacion</strong>.
          Les recuerda que deben completar su perfil y/o subir su documento W2.
        </p>
      </div>

      <div class="info-section">
        <h4>¬øA quienes se les envia?</h4>
        <ul class="info-list">
          <li>Clientes registrados hace <strong>mas de 3 dias</strong></li>
          <li>Que <strong>NO</strong> han completado su perfil, <strong>O</strong></li>
          <li>Que <strong>NO</strong> han subido su documento W2</li>
        </ul>
      </div>

      <div class="info-section">
        <h4>Proteccion contra spam</h4>
        <p>
          Cada cliente recibe <strong>maximo 3 recordatorios por mes</strong>.
          Si ya recibio 3, se omite automaticamente para no molestarlo.
        </p>
      </div>

      <div class="info-divider"></div>

      <div class="info-section">
        <h4>Controles disponibles</h4>
        <div class="control-explanation">
          <div class="control-item">
            <span class="control-icon btn-demo">üìÑ Recordar Docs</span>
            <span class="control-desc">
              <strong>Envio manual:</strong> Click para enviar recordatorios ahora mismo a todos los clientes pendientes.
            </span>
          </div>
          <div class="control-item">
            <span class="control-icon toggle-demo enabled">‚è∞</span>
            <span class="control-desc">
              <strong>Automatico ACTIVO:</strong> El sistema envia recordatorios automaticamente todos los dias a las 9:00 AM (hora Argentina).
            </span>
          </div>
          <div class="control-item">
            <span class="control-icon toggle-demo disabled">‚è∏Ô∏è</span>
            <span class="control-desc">
              <strong>Automatico PAUSADO:</strong> No se envian recordatorios automaticos. Solo se envian cuando haces click en "Recordar Docs".
            </span>
          </div>
        </div>
      </div>

      <div class="info-section current-status">
        <h4>Estado actual</h4>
        <div class="status-display">
          <span>Recordatorio automatico diario:</span>
          <span class="status-badge" [class.enabled]="missingDocsCronEnabled" [class.disabled]="!missingDocsCronEnabled">
            {{ missingDocsCronEnabled ? '‚è∞ ACTIVO' : '‚è∏Ô∏è PAUSADO' }}
          </span>
        </div>
        <button
          class="btn-toggle-cron"
          [class.to-enable]="!missingDocsCronEnabled"
          [class.to-disable]="missingDocsCronEnabled"
          (click)="toggleMissingDocsCron()"
          [disabled]="isTogglingCron">
          <span *ngIf="isTogglingCron">Cambiando...</span>
          <span *ngIf="!isTogglingCron && !missingDocsCronEnabled">Activar recordatorio automatico</span>
          <span *ngIf="!isTogglingCron && missingDocsCronEnabled">Pausar recordatorio automatico</span>
        </button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" (click)="showMissingDocsInfoModal = false">Entendido</button>
    </div>
  </div>
</div>
