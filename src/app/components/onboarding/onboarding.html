<div class="onboarding-container">

  <!-- Decorative Elements -->
  <div class="decoration decoration-1"></div>
  <div class="decoration decoration-2"></div>
  <div class="decoration decoration-3"></div>
  <div class="decoration decoration-4"></div>

  <!-- Content -->
  <div class="content-wrapper">

    <!-- Logo -->
    <div class="logo-container">
      <span class="logo-j">J</span><span class="logo-slash">/</span><span class="logo-ai">AI1</span>
    </div>

    <!-- Welcome Screen -->
    @if (currentStep === 'welcome') {
      <div class="welcome-card">
        <h1 class="welcome-title">
          Bienvenido a JAI1, <span class="highlight">{{ userName }}</span>
        </h1>
        <p class="welcome-subtitle">
          Una plataforma para que puedas realizar tu tax return de la manera más segura y confiable.
        </p>
        <button class="btn-primary" (click)="nextStep()">
          Comenzar
          <span class="btn-arrow">→</span>
        </button>
      </div>
    }

    <!-- Benefits Screen -->
    @if (currentStep === 'benefits') {
      <div class="benefits-card">
        <!-- Icon -->
        <div class="benefit-icon-container"
             [class.tracking]="currentBenefit.icon === 'tracking'"
             [class.support]="currentBenefit.icon === 'support'">
          @if (currentBenefit.icon === 'dashboard') {
            <svg class="benefit-icon" viewBox="0 0 64 64" fill="none">
              <rect x="8" y="8" width="48" height="48" rx="8" stroke="currentColor" stroke-width="2"/>
              <rect x="14" y="14" width="16" height="12" rx="2" fill="currentColor" opacity="0.3"/>
              <rect x="34" y="14" width="16" height="20" rx="2" fill="currentColor" opacity="0.3"/>
              <rect x="14" y="30" width="16" height="18" rx="2" fill="currentColor" opacity="0.3"/>
              <rect x="34" y="38" width="16" height="10" rx="2" fill="currentColor" opacity="0.3"/>
            </svg>
          }
          @if (currentBenefit.icon === 'tracking') {
            <svg class="benefit-icon" viewBox="0 0 64 64" fill="none">
              <circle cx="12" cy="32" r="6" fill="currentColor"/>
              <circle cx="32" cy="32" r="6" fill="currentColor" opacity="0.6"/>
              <circle cx="52" cy="32" r="6" fill="currentColor" opacity="0.3"/>
              <path d="M18 32h8M38 32h8" stroke="currentColor" stroke-width="2" stroke-dasharray="2 2"/>
              <path d="M12 20v-4M32 20v-4M52 20v-4" stroke="currentColor" stroke-width="2"/>
            </svg>
          }
          @if (currentBenefit.icon === 'support') {
            <svg class="benefit-icon" viewBox="0 0 64 64" fill="none">
              <path d="M32 8C18.7 8 8 17.2 8 28.5c0 6 3.2 11.4 8.3 15L14 52l10.2-5.1c2.4.7 5 1.1 7.8 1.1 13.3 0 24-9.2 24-20.5S45.3 8 32 8z" stroke="currentColor" stroke-width="2"/>
              <circle cx="22" cy="28" r="3" fill="currentColor"/>
              <circle cx="32" cy="28" r="3" fill="currentColor"/>
              <circle cx="42" cy="28" r="3" fill="currentColor"/>
            </svg>
          }
        </div>

        <h2 class="benefit-headline">{{ currentBenefit.headline }}</h2>
        <p class="benefit-subtext">{{ currentBenefit.subtext }}</p>

        <!-- Progress dots -->
        <div class="progress-dots">
          @for (benefit of benefits; track $index) {
            <span
              class="dot"
              [class.active]="$index === currentBenefitIndex"
              [class.completed]="$index < currentBenefitIndex"
            ></span>
          }
        </div>

        <div class="benefits-actions">
          @if (currentBenefitIndex > 0) {
            <button class="btn-secondary" (click)="previousBenefit()">
              <span>←</span>
              Anterior
            </button>
          }
          <button class="btn-primary" (click)="nextStep()">
            {{ currentBenefitIndex < benefits.length - 1 ? 'Siguiente' : 'Continuar' }}
            <span class="btn-arrow">→</span>
          </button>
        </div>
      </div>
    }

    <!-- Documents Check Screen -->
    @if (currentStep === 'documents') {
      <div class="documents-card">
        <div class="documents-header">
          <h2 class="documents-title">Antes de comenzar...</h2>
          <p class="documents-subtitle">¿Tenés todos los documentos necesarios?</p>
        </div>

        <div class="documents-checklist">
          <div class="checklist-item">
            <div class="check-circle">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="checklist-text">
              <span class="checklist-label">Formulario W2</span>
              <span class="checklist-hint">PDF, JPG o PNG</span>
            </div>
          </div>

          <div class="checklist-item">
            <div class="check-circle">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="checklist-text">
              <span class="checklist-label">SSN</span>
              <span class="checklist-hint">Social Security Number</span>
            </div>
          </div>

          <div class="checklist-item">
            <div class="check-circle">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="checklist-text">
              <span class="checklist-label">Cuenta bancaria de USA</span>
              <span class="checklist-hint">Para recibir tu reembolso</span>
            </div>
          </div>
        </div>

        <div class="documents-actions">
          <button class="btn-yes" (click)="onHasDocuments()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Sí, tengo todo
          </button>
          <button class="btn-no" (click)="onNoDocuments()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            No, aún no
          </button>
        </div>
      </div>
    }

    <!-- Calculator Screen -->
    @if (currentStep === 'calculator') {
      <div class="calculator-card">
        @if (calculatorState === 'upload') {
          <div class="calculator-header">
            <h2 class="calculator-title">Calculá tu reembolso</h2>
            <p class="calculator-subtitle">Subí tu W2 y te mostraremos una estimación</p>
          </div>

          <div
            class="upload-zone"
            [class.dragging]="isDragging"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
            (click)="fileInput.click()"
          >
            <input
              #fileInput
              type="file"
              accept=".jpg,.jpeg,.png,.pdf"
              (change)="onFileSelect($event)"
              hidden
            >
            <div class="upload-icon">
              <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M32 44V20M32 20l-10 10M32 20l10 10"/>
                <path d="M52 44v8a4 4 0 01-4 4H16a4 4 0 01-4-4v-8"/>
              </svg>
            </div>
            <p class="upload-text">Arrastrá tu W2 aquí o hacé clic para seleccionar</p>
            <span class="upload-hint">JPG, PNG o PDF</span>
          </div>

          <button class="skip-link" (click)="skipCalculator()">
            Omitir por ahora
          </button>
        }

        @if (calculatorState === 'calculating') {
          <div class="calculating-container">
            <div class="calculating-animation">
              <div class="spinner"></div>
            </div>
            <p class="calculating-title">{{ progressText }}</p>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="calculationProgress"></div>
            </div>
            <span class="progress-percent">{{ calculationProgress | number:'1.0-0' }}%</span>
            <button class="skip-link calculating-skip" (click)="cancelAndSkip()">
              Cancelar y continuar sin calcular
            </button>
          </div>
        }

        @if (calculatorState === 'error') {
          <div class="error-container">
            <div class="error-icon-container">
              <svg class="error-icon" viewBox="0 0 64 64" fill="none">
                <circle cx="32" cy="32" r="28" stroke="currentColor" stroke-width="3"/>
                <line x1="32" y1="18" x2="32" y2="36" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                <circle cx="32" cy="44" r="3" fill="currentColor"/>
              </svg>
            </div>
            <p class="error-title">Hubo un problema</p>
            <p class="error-message">{{ errorMessage }}</p>
            <div class="error-actions">
              <button class="btn-secondary" (click)="retryCalculation()">
                Intentar de nuevo
              </button>
              <button class="btn-primary" (click)="skipCalculator()">
                Continuar sin calcular
                <span class="btn-arrow">→</span>
              </button>
            </div>
          </div>
        }

        @if (calculatorState === 'result') {
          <div class="result-container">
            <div class="result-badge">Estimación completada</div>
            <p class="result-title">Tu reembolso estimado</p>
            <div class="result-amount">{{ formatCurrency(estimatedRefund) }}</div>
            <p class="result-disclaimer">
              *Esta es una estimación basada en tu W2. El monto final puede variar.
            </p>
            <button class="btn-primary" (click)="goToDashboard()">
              ¡Quiero mi reembolso!
              <span class="btn-arrow">→</span>
            </button>
          </div>
        }
      </div>
    }

    <!-- Warning Screen -->
    @if (currentStep === 'warning') {
      <div class="warning-card">
        <div class="warning-icon-container">
          <svg class="warning-icon" viewBox="0 0 64 64" fill="none">
            <path d="M32 8L4 56h56L32 8z" stroke="currentColor" stroke-width="3" fill="none"/>
            <line x1="32" y1="24" x2="32" y2="38" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <circle cx="32" cy="46" r="2" fill="currentColor"/>
          </svg>
        </div>

        <h2 class="warning-title">Documentos requeridos</h2>

        <p class="warning-text">
          Los documentos mencionados son <strong>indispensables</strong> para poder procesar tu declaración de impuestos.
        </p>

        <p class="warning-text">
          Sin ellos, no es posible completar el proceso de tax return.
        </p>

        <div class="warning-box">
          <p>Te recomendamos:</p>
          <ul>
            <li>Solicitar tu W2 a tu empleador</li>
            <li>Tener a mano tu número de SSN</li>
            <li>Abrir una cuenta bancaria en USA si aún no la tenés</li>
          </ul>
        </div>

        <button class="btn-secondary" (click)="exploreApp()">
          Entendido, explorar la app
        </button>
      </div>
    }

  </div>

</div>
