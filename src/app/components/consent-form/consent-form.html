<!-- Loading State -->
<div class="consent-loading" *ngIf="!hasLoaded">
  <div class="loading-spinner"></div>
  <p>Cargando acuerdo...</p>
</div>

<!-- Main Content -->
<div class="consent-container" *ngIf="hasLoaded" [class.modal-mode]="isModal">
  <!-- Header -->
  <div class="consent-header">
    <div class="header-logo">
      <span class="logo-text">JAI-1</span>
    </div>
    <h1 class="header-title">ACUERDO POR PRESTACION DE SERVICIOS</h1>
  </div>

  <!-- Missing Fields Warning -->
  <div class="warning-card" *ngIf="prefilledData && !prefilledData.canSign">
    <div class="warning-icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
        <line x1="12" y1="9" x2="12" y2="13"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
    </div>
    <div class="warning-content">
      <h3>Completa tu perfil para firmar</h3>
      <p>Faltan los siguientes datos:</p>
      <ul>
        <li *ngFor="let field of prefilledData.missingFields">
          {{ field === 'address' ? 'Direccion' : field === 'city' ? 'Ciudad' : field }}
        </li>
      </ul>
      <a routerLink="/profile" class="warning-link">Completar perfil</a>
    </div>
  </div>

  <!-- Document Content -->
  <div class="document-wrapper">
    <div class="document-content">
      <!-- Introduction -->
      <div class="document-intro">
        <p>
          Entre <strong>JAI-1</strong>, con domicilio electronico en la casilla de correo jai1&#64;memas.agency, en adelante la <strong>empresa</strong>, y
          <span class="prefilled-field">{{ prefilledData?.fullName || '_______________' }}</span>,
          DNI/Pasaporte <span class="prefilled-field">{{ prefilledData?.dniPassport || '_______________' }}</span>,
          con domicilio en calle <span class="prefilled-field">{{ prefilledData?.street || '_______________' }}</span>
          de la ciudad de <span class="prefilled-field">{{ prefilledData?.city || '_______________' }}</span>
          y electronico en la casilla de correo <span class="prefilled-field">{{ prefilledData?.email || '_______________' }}</span>,
          en adelante el <strong>cliente</strong>, se celebra el presente acuerdo sujeto a las siguientes clausulas y condiciones:
        </p>
      </div>

      <!-- Clauses -->
      <div class="document-clauses">
        <div class="clause" *ngFor="let clause of clauses">
          <p>{{ clause }}</p>
        </div>
      </div>

      <!-- Closing -->
      <div class="document-closing">
        <p>
          En prueba de conformidad, se firman dos ejemplares de un mismo tenor y a un solo efecto,
          a los <span class="prefilled-field">{{ formattedDate }}</span>.-
        </p>
      </div>

      <!-- Signatures Section -->
      <div class="signatures-section">
        <!-- Client Signature -->
        <div class="signature-block client-signature">
          <label class="signature-label">FIRMA CLIENTE:</label>
          <div class="signature-canvas-wrapper">
            <canvas
              #signatureCanvas
              class="signature-canvas"
              [class.has-signature]="hasSignature">
            </canvas>
            <button
              class="btn-clear-signature"
              *ngIf="hasSignature"
              (click)="clearSignature()"
              type="button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
              Limpiar
            </button>
          </div>
          <p class="signature-hint" *ngIf="!hasSignature">Dibuja tu firma aqui</p>
        </div>

        <!-- JAI-1 Signatures -->
        <div class="jai1-signatures">
          <div class="signature-block">
            <label class="signature-label">FIRMA JAI-1:</label>
            <div class="jai1-signature-line">
              <span class="signature-placeholder">________________</span>
              <span class="signer-name">Francisco Uria</span>
            </div>
          </div>

          <div class="signature-block">
            <label class="signature-label">FIRMA JAI-1:</label>
            <div class="jai1-signature-line">
              <span class="signature-placeholder">________________</span>
              <span class="signer-name">Lautaro Iglesias</span>
            </div>
          </div>

          <div class="signature-block">
            <label class="signature-label">FIRMA JAI-1:</label>
            <div class="jai1-signature-line">
              <span class="signature-placeholder">________________</span>
              <span class="signer-name">Tomas Bucci</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Actions -->
  <div class="consent-footer">
    <div class="footer-info">
      <span>www.jai1.tax</span>
      <span class="separator">|</span>
      <span>+54 9 2236 68 8497</span>
      <span class="separator">|</span>
      <span>jai1&#64;memas.agency</span>
    </div>

    <div class="footer-actions">
      <button
        class="btn-secondary"
        (click)="cancel()"
        *ngIf="isModal">
        Cancelar
      </button>
      <button
        class="btn-primary"
        [disabled]="!hasSignature || !prefilledData?.canSign || isSigning"
        (click)="signAgreement()">
        <span *ngIf="!isSigning">Firmar Acuerdo</span>
        <span *ngIf="isSigning" class="btn-loading">
          <span class="spinner-small"></span>
          Firmando...
        </span>
      </button>
    </div>
  </div>
</div>
