<!-- Loading Screen -->
@if (!hasLoaded) {
  <div class="dashboard-loading">
    <div class="loading-spinner"></div>
    <p>Cargando tu dashboard...</p>
  </div>
}

<!-- Dashboard Content -->
@if (hasLoaded) {
<div class="dashboard-content">
  <!-- Refund Card -->
  <div class="refund-card">
    <div class="refund-header">
      <span class="refund-icon">ğŸ’°</span>
      <span class="refund-label">Reembolso Estimado</span>
    </div>

    @if (hasCalculatorResult) {
      <div class="refund-amount">{{ estimatedRefundDisplay }}</div>
      <div class="refund-calculated">
        <span class="check-icon">âœ“</span>
        Calculado con tu W2
      </div>
      <button class="btn-recalculate" (click)="navigateTo('/tax-calculator')">
        Recalcular â†’
      </button>
    } @else {
      <div class="refund-not-calculated">
        <span class="question-icon">ğŸ§®</span>
        <span>AÃºn no calculado</span>
      </div>
      <button class="btn-calculate-cta" (click)="navigateTo('/tax-calculator')">
        <span>Calcular mi reembolso</span>
        <span class="arrow">â†’</span>
      </button>
    }
  </div>

  <!-- Steps Section -->
  @if (!allStepsCompleted) {
    <div class="steps-section">
      <!-- Step 1: CompletÃ¡ tu declaraciÃ³n -->
      <div class="step-card"
           [class.completed]="isStep1Complete"
           [class.attention]="!isStep1Complete"
           (click)="navigateTo('/tax-form')">
        <div class="step-number-badge" [class.completed]="isStep1Complete">
          @if (isStep1Complete) {
            <span class="checkmark">âœ“</span>
          } @else {
            1
          }
        </div>
        <div class="step-icon">ğŸ“</div>
        <h3 class="step-title">CompletÃ¡ tu declaraciÃ³n</h3>
        <p class="step-description">LlenÃ¡ el formulario con tus datos personales y tributarios</p>
        <button class="step-button" [class.completed]="isStep1Complete">
          @if (isStep1Complete) {
            Completado âœ“
          } @else {
            Completar declaraciÃ³n â†’
          }
        </button>
      </div>

      <!-- Step 2: SubÃ­ tu documento W2 -->
      <div class="step-card"
           [class.completed]="isStep2Complete"
           (click)="navigateTo('/documents')">
        <div class="step-number-badge" [class.completed]="isStep2Complete">
          @if (isStep2Complete) {
            <span class="checkmark">âœ“</span>
          } @else {
            2
          }
        </div>
        <div class="step-icon">ğŸ“„</div>
        <h3 class="step-title">SubÃ­ tu documento W2</h3>
        <p class="step-description">CargÃ¡ tu formulario W2 para calcular tu reembolso</p>
        <button class="step-button" [class.completed]="isStep2Complete">
          @if (isStep2Complete) {
            Completado âœ“
          } @else {
            Ir a mis documentos â†’
          }
        </button>
      </div>

      <!-- Step 3: SubÃ­ tu comprobante de pago -->
      <div class="step-card"
           [class.completed]="isStep3Complete"
           (click)="navigateTo('/documents')">
        <div class="step-number-badge" [class.completed]="isStep3Complete">
          @if (isStep3Complete) {
            <span class="checkmark">âœ“</span>
          } @else {
            3
          }
        </div>
        <div class="step-icon">ğŸ’³</div>
        <h3 class="step-title">SubÃ­ tu comprobante de pago</h3>
        <p class="step-description">AdjuntÃ¡ el comprobante del pago inicial</p>
        <button class="step-button" [class.completed]="isStep3Complete">
          @if (isStep3Complete) {
            Completado âœ“
          } @else {
            Ir a mis documentos â†’
          }
        </button>
      </div>
    </div>
  }

  <!-- All Steps Completed Banner -->
  @if (allStepsCompleted) {
    <div class="completion-banner">
      <div class="completion-icon">âœ“</div>
      <div class="completion-content">
        <h2 class="completion-title">PreparaciÃ³n completada</h2>
        <p class="completion-subtitle">Todos los pasos completados</p>
      </div>
      <div class="completion-badge">100%</div>
    </div>

    <!-- IRS Status Summary - Modern compact view -->
    @if (showIRSProgress) {
      <div class="irs-summary-card" (click)="navigateTo('/tax-tracking')">
        <div class="irs-summary-header">
          <div class="irs-summary-title">
            <span class="irs-summary-icon">ğŸ›ï¸</span>
            <div>
              <h3>Estado con el IRS</h3>
              <p>{{ getCurrentStatusMessage() }}</p>
            </div>
          </div>
          <div class="irs-summary-badge" [class.complete]="isRefundDeposited" [class.processing]="!isRefundDeposited">
            @if (isRefundDeposited) {
              âœ“ Completado
            } @else {
              En proceso
            }
          </div>
        </div>

        <div class="irs-tracks-summary">
          <!-- Federal Summary -->
          <div class="track-summary">
            <div class="track-summary-header">
              <span class="track-emoji">ğŸ¦…</span>
              <span class="track-name">Federal</span>
              <span class="track-percent">{{ getFederalPercent() }}%</span>
            </div>
            <div class="track-mini-bar">
              <div class="track-mini-fill federal" [style.width.%]="getFederalPercent()"></div>
            </div>
            <span class="track-status-text">{{ getFederalStatusText() }}</span>
          </div>

          <!-- Divider -->
          <div class="tracks-divider"></div>

          <!-- Estatal Summary -->
          <div class="track-summary">
            <div class="track-summary-header">
              <span class="track-emoji">ğŸ—½</span>
              <span class="track-name">Estatal</span>
              <span class="track-percent">{{ getEstatalPercent() }}%</span>
            </div>
            <div class="track-mini-bar">
              <div class="track-mini-fill estatal" [style.width.%]="getEstatalPercent()"></div>
            </div>
            <span class="track-status-text">{{ getEstatalStatusText() }}</span>
          </div>
        </div>

        <div class="irs-summary-footer">
          <span class="view-details">Ver seguimiento completo</span>
          <span class="arrow-icon">â†’</span>
        </div>
      </div>
    }
  }

  <!-- Help Footer -->
  <div class="help-footer">
    <div class="help-icon">ğŸ’¬</div>
    <div class="help-text">
      <span class="help-title">Â¿Necesitas ayuda?</span>
      <span class="help-desc">Nuestro equipo estÃ¡ listo para asistirte</span>
    </div>
    <button class="btn-help" (click)="navigateTo('/messages')">Contactar soporte</button>
  </div>
</div>
}
