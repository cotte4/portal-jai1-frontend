<div class="admin-container">
  <!-- Header -->
  <header class="admin-header">
    <div class="header-content">
      <div class="header-left">
        <button class="btn-back" (click)="goBack()">
          <span class="back-arrow">&#8592;</span>
          Volver
        </button>
        <div class="logo">JAI1</div>
        <span class="admin-badge">Pagos</span>
      </div>
      <div class="header-right">
        <button class="btn-export" (click)="exportToExcel()" [disabled]="isExporting || clients.length === 0">
          {{ isExporting ? 'Exportando...' : 'Exportar Excel' }}
        </button>
        <button class="btn-refresh" (click)="refreshData()" [disabled]="isLoading">
          <span *ngIf="!isLoading">Actualizar</span>
          <span *ngIf="isLoading">Cargando...</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="admin-main">
    <!-- Page Title -->
    <div class="page-header">
      <div>
        <h1>Resumen de Pagos</h1>
        <p>Calculo de comisiones y pagos a clientes</p>
      </div>
      <div class="total-badge" *ngIf="hasLoaded && !errorMessage">
        <span class="total-count">{{ clientCount }}</span>
        <span class="total-label">Clientes con Refunds</span>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards" *ngIf="hasLoaded && !errorMessage">
      <div class="summary-card">
        <div class="summary-icon taxes-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
        </div>
        <div class="summary-content">
          <div class="summary-value">{{ formatCurrency(totals.totalTaxes) }}</div>
          <div class="summary-label">Total Taxes (Refunds)</div>
        </div>
      </div>

      <div class="summary-card highlight">
        <div class="summary-icon commission-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
            <line x1="1" y1="10" x2="23" y2="10"></line>
          </svg>
        </div>
        <div class="summary-content">
          <div class="summary-value">{{ formatCurrency(totals.totalCommission) }}</div>
          <div class="summary-label">Total Comision (11%)</div>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon client-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="summary-content">
          <div class="summary-value">{{ formatCurrency(totals.clientReceives) }}</div>
          <div class="summary-label">Total a Clientes</div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-banner" *ngIf="errorMessage">
      <div class="error-content">
        <span class="error-icon">!</span>
        <span class="error-message">{{ errorMessage }}</span>
      </div>
      <button class="btn-retry" (click)="refreshData()">Reintentar</button>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading && !hasLoaded">
      <div class="spinner"></div>
      <p>Cargando pagos...</p>
    </div>

    <!-- Payments Table -->
    <div class="payments-section" *ngIf="hasLoaded && !errorMessage">
      <div class="section-header">
        <h2>Detalle de Pagos por Cliente</h2>
        <div class="search-box">
          <input
            type="text"
            [(ngModel)]="searchQuery"
            (input)="filterByName()"
            placeholder="Buscar por nombre..."
            class="search-input"
          />
        </div>
      </div>

      <div class="table-wrapper">
        <div class="payments-table" *ngIf="filteredClients.length > 0">
          <div class="table-header">
            <div class="col-name">Cliente</div>
            <div class="col-federal">Federal Taxes</div>
            <div class="col-state">State Taxes</div>
            <div class="col-total-taxes">Total Taxes</div>
            <div class="col-fed-comm">Comision Fed.</div>
            <div class="col-state-comm">Comision Est.</div>
            <div class="col-total-comm">Total Comision</div>
            <div class="col-receives">Cliente Recibe</div>
            <div class="col-status">Estado</div>
          </div>

          <div class="table-body">
            <div class="table-row" *ngFor="let client of filteredClients; trackBy: trackById" (click)="viewClient(client.id)">
              <div class="col-name">
                <div class="user-avatar">
                  {{ getInitials(client.name) }}
                </div>
                <div class="user-info">
                  <span class="user-name">{{ client.name }}</span>
                  <span class="user-email">{{ client.email }}</span>
                </div>
              </div>

              <div class="col-federal">
                <span class="amount">{{ formatCurrency(client.federalTaxes) }}</span>
              </div>

              <div class="col-state">
                <span class="amount">{{ formatCurrency(client.stateTaxes) }}</span>
              </div>

              <div class="col-total-taxes">
                <span class="amount total">{{ formatCurrency(client.totalTaxes) }}</span>
              </div>

              <div class="col-fed-comm">
                <span class="amount commission">{{ formatCurrency(client.federalCommission) }}</span>
              </div>

              <div class="col-state-comm">
                <span class="amount commission">{{ formatCurrency(client.stateCommission) }}</span>
              </div>

              <div class="col-total-comm">
                <span class="amount commission total">{{ formatCurrency(client.totalCommission) }}</span>
              </div>

              <div class="col-receives">
                <span class="amount receives">{{ formatCurrency(client.clientReceives) }}</span>
              </div>

              <div class="col-status">
                <span class="status-badge" [ngClass]="getPaymentStatusClass(client)">
                  {{ getPaymentStatusLabel(client) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Totals Row -->
          <div class="table-totals">
            <div class="col-name">
              <span class="totals-label">TOTALES</span>
            </div>
            <div class="col-federal">
              <span class="amount total-value">{{ formatCurrency(totals.federalTaxes) }}</span>
            </div>
            <div class="col-state">
              <span class="amount total-value">{{ formatCurrency(totals.stateTaxes) }}</span>
            </div>
            <div class="col-total-taxes">
              <span class="amount total-value highlight">{{ formatCurrency(totals.totalTaxes) }}</span>
            </div>
            <div class="col-fed-comm">
              <span class="amount total-value">{{ formatCurrency(totals.federalCommission) }}</span>
            </div>
            <div class="col-state-comm">
              <span class="amount total-value">{{ formatCurrency(totals.stateCommission) }}</span>
            </div>
            <div class="col-total-comm">
              <span class="amount total-value highlight">{{ formatCurrency(totals.totalCommission) }}</span>
            </div>
            <div class="col-receives">
              <span class="amount total-value highlight">{{ formatCurrency(totals.clientReceives) }}</span>
            </div>
            <div class="col-status"></div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredClients.length === 0">
        <div class="empty-icon">&#128176;</div>
        <h3>{{ searchQuery ? 'No se encontraron resultados' : 'No hay pagos registrados' }}</h3>
        <p>{{ searchQuery ? 'Intenta con otro nombre' : 'Cuando se registren refunds para los clientes, apareceran aqui' }}</p>
      </div>
    </div>
  </main>
</div>
